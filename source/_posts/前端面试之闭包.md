---
title: 前端面试之闭包
date: 2022-07-27 22:33:17
tags: 前端面试
categories:
- 前端面试
---


## 6，什么是作用域，什么是作用域链

作用域：变量起作用的范围
        * js中只有两种：全局作用域  局部作用域
        *
       1.全局作用域：变量在任何地方起作用
        * 全局变量:在函数外面声明

​       2.局部作用域：变量只能在函数内部起作用
       局部变量：在函数内部声明

- 1.作用域链是怎么来的
  - 默认情况下，我们的js代码处于全局作用域，当我们声明一个函数时，此时函数体会开辟一个局部作用域， 如果我们在这个函数体中又声明一个函数，那么又会开辟一个新的局部作用域，以此类推，就会形成一个作用域链
- 2.变量在作用域链上的访问规则
  - 就近原则：访问变量时，会优先访问的是在自己作用域链上声明的变量，如果自己作用域链上没有声明这个变量，那么就往上一级去找有没有声明这个变量，如果有就访问，如果没有就继续往上找有没有声明，直到找到0级作用域链上，如果有，就访问，如果没有就报错




## 5，什么是闭包，闭包都有哪些特性

闭包是什么： JS 的函数内部可以使用函数外部的变量

正是由于 JS 的函数内部可以使用函数外部的变量，所以这段代码正好符合了闭包的定义。而不是 JS 故意要使用闭包。 

闭包的特性：

1. 函数嵌套函数
2. 函数内部可以引用外部的参数和变量
3. 参数和变量不会被垃圾回收机制回收

**闭包会造成内存泄露？**

**错。**

**说这话的人根本不知道什么是内存泄露。内存泄露是指你用不到（访问不到）的变量，依然占居着内存空间，不能被再次利用起来。** 

**闭包里面的变量明明就是我们需要的变量（lives），凭什么说是内存泄露？**

**这个谣言是如何来的？**

**因为 IE。IE 有 bug，IE 在我们使用完闭包之后，依然回收不了闭包里面引用的变量。**

**这是 IE 的问题，不是闭包的问题。参见司徒正美的[这篇文章](https://link.zhihu.com/?target=http%3A//www.cnblogs.com/rubylouvre/p/3345294.html)。

闭包的优点：

可以设计私有的方法和变量 

闭包的作用：

闭包常常用来「间接访问一个变量」。换句话说，「隐藏一个变量」。 

这里面确实有闭包，local 变量和 bar 函数就组成了一个闭包（Closure）。

```js
function foo(){
  var local = 1
  function bar(){
    local++
    return local
  }
  return bar
}

var func = foo()
func()
//为什么要函数套函数呢

//是因为需要局部变量，所以才把 local 放在一个函数里，如果不把 local 放在一个函数里，local 就是一个全局变量了，达不到使用闭包的目的——隐藏变量（等会会讲）。 

```

## 闭包经典面试题
```js
  function create(){
    const a=100
    //  调用使用的a的变量是在开始定义时候
    return function(){
      console.log(a)
    }
  }

  const fn=create()

  //使用的变量而不是函数执行的时候
  const a=200
  fn() // 100
  
```

```js
  function print(){
    const a=200
    fn() //而不是函数执行的时候查找上级作用域中的变量200

  }
  const a=100
  function fn(){
    //函数使用变量在函数定义的时候
    console.log(a)   //查找上级作用域中的变量100
  }
  
 print(fn) //100
 ```

**自由变量的查找是在函数定义的时候进行查找，而不是在函数执行的时候进行查找**

## This

**this取什么值是在函数执行的时候而不是在函数定义的时候**

* this当做普通函数被调用this指向的是window
* 是用call，apply，bind传入什么就绑定什么
* 作为对象方法被调用返回对象本身
* class方法调用返回实例本身
* 箭头函数上级作用域的this
